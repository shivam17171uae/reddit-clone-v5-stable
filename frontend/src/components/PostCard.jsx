import React from 'react'; import { Link } from 'react-router-dom'; import { useAuth } from '../context/AuthContext'; import MarkdownRenderer from './MarkdownRenderer';
function PostCard({ post, onUpdate, isDetailView = false }) { const { token } = useAuth(); const handleVote = async (voteValue) => { if (!token) return alert("Please log in."); const finalVote = post.user_vote === voteValue ? 0 : voteValue; await fetch('/api/vote',{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`},body:JSON.stringify({postId:post.id,voteValue:finalVote})}); if(onUpdate)onUpdate(); }; const Title = () => { const titleClasses = `text-xl font-semibold mt-1 text-gray-100 ${!isDetailView ? 'hover:underline' : ''}`; if (post.post_type === 'link' && post.url) { return (<a href={post.url} target="_blank" rel="noopener noreferrer" className={titleClasses}>{post.title}<span className="text-xs text-gray-500 ml-2">({new URL(post.url).hostname})</span></a>); } if (isDetailView) { return <h2 className={titleClasses}>{post.title}</h2>; } return (<Link to={`/c/${post.community_name}/posts/${post.id}`} className={titleClasses}>{post.title}</Link>); }; return ( <div className="bg-gray-800 rounded-lg shadow-lg flex p-4"> <div className="flex flex-col items-center mr-4 flex-shrink-0"> <button onClick={() => handleVote(1)} className={`text-2xl ${post.user_vote === 1 ? 'text-orange-500' : 'text-gray-500 hover:text-orange-400'}`}>▲</button> <span className="text-xl font-bold my-1">{post.votes}</span> <button onClick={() => handleVote(-1)} className={`text-2xl ${post.user_vote === -1 ? 'text-blue-500' : 'text-gray-500 hover:text-blue-400'}`}>▼</button> </div> <div className="flex-grow min-w-0"> <div className="text-xs text-gray-500"> <Link to={`/c/${post.community_name}`} className="font-bold hover:underline">c/{post.community_name}</Link> - Posted by <Link to={`/u/${post.username}`} className="hover:underline">u/{post.username}</Link> </div> <Title /> {isDetailView && post.post_type === 'text' && post.content && (<div className="mt-4 text-gray-300"><MarkdownRenderer content={post.content} /></div>)} {post.post_type === 'image' && post.image_url && (<a href={post.image_url} target="_blank" rel="noopener noreferrer"><img src={post.image_url} alt={post.title} className="mt-4 max-h-96 rounded-lg object-cover" /></a>)} <div className="mt-4"><Link to={`/c/${post.community_name}/posts/${post.id}`} className="text-gray-400 text-sm hover:text-white">{post.comment_count} Comments</Link></div> </div> </div> );}
export default PostCard;
