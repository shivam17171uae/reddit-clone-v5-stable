import React, { useState, useEffect, useCallback } from 'react'; import PostCard from './PostCard';
function PostList({ communityName }) { const [posts, setPosts] = useState([]); const [sort, setSort] = useState('hot'); const [page, setPage] = useState(1); const [loading, setLoading] = useState(false); const fetchPosts = useCallback(async () => { setLoading(true); try { let url=`/api/posts?sort=${sort}&page=${page}`; if(communityName){url+=`&communityName=${communityName}`;} const res = await fetch(url); if (res.ok) { setPosts(await res.json()); } } catch (e) {} setLoading(false); }, [sort, communityName, page]); useEffect(() => { fetchPosts(); }, [fetchPosts]); return ( <div> <div className="flex space-x-2 mb-4"> {['hot','new','top'].map(s=><button key={s} onClick={()=>{setSort(s);setPage(1);}} className={`px-3 py-1 rounded text-sm ${sort===s?'bg-orange-600':'bg-gray-700'}`}>{s.charAt(0).toUpperCase()+s.slice(1)}</button>)} </div> {loading ? <div className="text-center p-4">Loading...</div> : <div className="space-y-4">{posts.map(post=><PostCard key={post.id} post={post} onUpdate={fetchPosts}/>)}</div>} <div className="flex justify-between mt-4"> <button onClick={() => setPage(p => Math.max(1, p - 1))} disabled={page===1} className="bg-gray-700 px-4 py-2 rounded disabled:opacity-50">Previous</button> <span>Page {page}</span> <button onClick={() => setPage(p => p + 1)} disabled={posts.length < 10} className="bg-gray-700 px-4 py-2 rounded disabled:opacity-50">Next</button> </div> </div> );}
export default PostList;
